Select 
YEAR(esh.[Order Date]) as Jahr, 
COUNT(distinct esh.[External Document No_]) as AnzahlBestellungenImJahr,
esh.[Sell-to Account No_], 
case when ena.[Customer Type Id] = 4 then 'China' else 'General' end as Kundengruppe,
(
Select 
count( distinct esh1.[External Document No_])
from Urban_NAV600_SL.dbo.[Urban-Brand GmbH$eBayNavCSalesHeader] as esh1 with (nolock)
inner join Urban_NAV600_SL.dbo.[Urban-Brand GmbH$Sales Shipment Header] as sh with (nolock)
	on esh1.[External Document No_] = sh.[External Document No_]
where year(esh1.[Order Date]) <= year(esh.[Order Date]) and esh1.[Sell-to Account No_] = esh.[Sell-to Account No_]
) as AnzahlBestellungenKumuliert
from Urban_NAV600_SL.dbo.[Urban-Brand GmbH$eBayNavCSalesHeader] as esh with (nolock)
inner join Urban_NAV600_SL.dbo.[Urban-Brand GmbH$Sales Shipment Header] as sh with (nolock)
	on esh.[External Document No_] = sh.[External Document No_]
inner join Urban_NAV600_SL.dbo.[Urban-Brand GmbH$eBayNavCAccount] as ena with (nolock)
	on esh.[Sell-to Account No_] = ena.No_
where ena.[Customer No_] not in ('')
Group By 
YEAR(esh.[Order Date]),
esh.[Sell-to Account No_], 
ena.[Customer Type Id] 
